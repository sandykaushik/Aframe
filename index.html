<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confined Space Entry VR Training</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- A-Frame Extras (for movement-controls) -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    
    <!-- A-Frame Super Hands (for interaction) -->
    <script src="https://unpkg.com/super-hands@3.0.3/dist/super-hands.min.js"></script>
</head>
<body>
    <!-- 2D UI Overlay -->
    <div id="ui-overlay">
        <div id="task-panel">
            <h2>Confined Space Entry Training</h2>
            <div id="task-list">
                <div class="task" id="task-1">
                    <span class="task-number">1.</span>
                    <span class="task-text">Test atmosphere with gas meter</span>
                    <span class="task-status">⏳</span>
                </div>
                <div class="task" id="task-2">
                    <span class="task-number">2.</span>
                    <span class="task-text">Identify hazards in the space</span>
                    <span class="task-status">⏳</span>
                </div>
                <div class="task" id="task-3">
                    <span class="task-number">3.</span>
                    <span class="task-text">Isolate energy source (turn valve)</span>
                    <span class="task-status">⏳</span>
                </div>
                <div class="task" id="task-4">
                    <span class="task-number">4.</span>
                    <span class="task-text">Verify isolation complete</span>
                    <span class="task-status">⏳</span>
                </div>
            </div>
        </div>
        
        <div id="hazard-warning" style="display: none;">
            <h3>⚠️ HAZARD IDENTIFIED ⚠️</h3>
            <p>Leaking pressurized hose detected</p>
            <p>Isolate energy source before proceeding</p>
        </div>
        
        <div id="completion-panel" style="display: none;">
            <h2>✓ TRAINING COMPLETE</h2>
            <p>All confined space entry procedures completed successfully</p>
            <button onclick="location.reload()">Restart Training</button>
        </div>
    </div>

    <!-- A-Frame Scene -->
    <a-scene 
        vr-mode-ui="enabled: true"
        renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true"
        training-manager
        shadow="type: pcf; autoUpdate: true">
        
        <!-- Asset Management -->
        <a-assets timeout="10000">
            <audio id="hiss-sound" preload="auto"></audio>
            <audio id="valve-sound" preload="auto"></audio>
        </a-assets>

        <!-- Enhanced Lighting Setup -->
        <!-- Main overhead lights -->
        <a-light type="directional" 
                 intensity="0.8" 
                 position="2 4 0" 
                 target="#tunnel"
                 castShadow="true"
                 shadow-camera-visible="false"
                 shadow-camera-near="0.1"
                 shadow-camera-far="10"
                 color="#ffffee"></a-light>
        
        <a-light type="directional" 
                 intensity="0.6" 
                 position="-2 4 -3" 
                 castShadow="true"
                 color="#ffffee"></a-light>

        <!-- Ambient lighting for overall brightness -->
        <a-light type="ambient" intensity="0.6" color="#f0f0f0"></a-light>

        <!-- Point lights for additional illumination -->
        <a-light type="point" intensity="1.2" distance="5" position="0 2 2" color="#ffffff"></a-light>
        <a-light type="point" intensity="1.2" distance="5" position="0 2 -4" color="#ffffff"></a-light>

        <!-- Player Rig with Collision -->
        <a-entity id="rig" 
                  movement-controls="speed: 0.03; fly: false; constrainToNavMesh: false" 
                  position="0 0 3.5"
                  collision-player>
            
            <!-- Camera with headlamp -->
            <a-entity id="camera" 
                      camera 
                      look-controls="pointerLockEnabled: false; touchEnabled: true"
                      position="0 1.6 0">
                
                <!-- Headlamp spotlight -->
                <a-light type="spot" 
                         intensity="2.0" 
                         angle="40" 
                         penumbra="0.3"
                         distance="10"
                         decay="1.5"
                         color="#fff8e1"
                         position="0 0 0.2"
                         rotation="0 0 0"
                         castShadow="true"></a-light>
                
                <!-- VR Controllers with better interaction -->
                <a-entity id="left-hand" 
                          hand-controls="hand: left; handModelStyle: lowPoly"
                          laser-controls="hand: left"
                          raycaster="objects: .interactive; far: 3"
                          super-hands="colliderEvent: raycaster-intersection;
                                     colliderEventProperty: els;
                                     colliderEndEvent: raycaster-intersection-cleared;
                                     colliderEndEventProperty: clearedEls;">
                </a-entity>
                
                <a-entity id="right-hand" 
                          hand-controls="hand: right; handModelStyle: lowPoly"
                          laser-controls="hand: right"
                          raycaster="objects: .interactive; far: 3"
                          super-hands="colliderEvent: raycaster-intersection;
                                     colliderEventProperty: els;
                                     colliderEndEvent: raycaster-intersection-cleared;
                                     colliderEndEventProperty: clearedEls;">
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- CONFINED SPACE ENVIRONMENT -->
        <!-- Main tunnel (narrow cylinder with collision) - RADIUS 1.2m -->
        <a-cylinder id="tunnel" 
                    radius="1.2" 
                    height="8" 
                    position="0 1.6 0"
                    rotation="0 0 90"
                    color="#d4d4d4"
                    metalness="0.4"
                    roughness="0.6"
                    side="back"
                    shadow="receive: true"
                    static-body>
        </a-cylinder>

        <!-- Tunnel end caps with collision -->
        <a-circle position="-4 1.6 0" 
                  rotation="0 90 0" 
                  radius="1.2" 
                  color="#b0b0b0"
                  metalness="0.3"
                  roughness="0.7"
                  static-body></a-circle>
        
        <a-circle position="4 1.6 0" 
                  rotation="0 -90 0" 
                  radius="1.2" 
                  color="#b0b0b0"
                  metalness="0.3"
                  roughness="0.7"
                  static-body></a-circle>

        <!-- Floor - Metallic grating with collision -->
        <a-plane id="floor"
                 position="0 0 0" 
                 rotation="-90 0 0" 
                 width="8" 
                 height="2.4" 
                 color="#8a8a8a"
                 metalness="0.7"
                 roughness="0.5"
                 shadow="receive: true"
                 static-body>
            <!-- Grid pattern for floor -->
            <a-entity position="0 0 0.01">
                <a-plane width="7.8" height="2.2" color="#707070" wireframe="true"></a-plane>
            </a-entity>
        </a-plane>

        <!-- Ceiling -->
        <a-plane position="0 3.2 0" 
                 rotation="90 0 0" 
                 width="8" 
                 height="2.4" 
                 color="#c0c0c0"
                 metalness="0.5"
                 roughness="0.6"
                 shadow="receive: true"></a-plane>

        <!-- Industrial Pipes along walls -->
        <a-entity id="pipe-system">
            <!-- Top pipe -->
            <a-cylinder position="0 2.8 0.9" 
                        radius="0.08" 
                        height="7.5" 
                        rotation="0 0 90"
                        color="#4a4a4a"
                        metalness="0.9"
                        roughness="0.2"
                        shadow="cast: true; receive: true">
                <!-- Pipe joints -->
                <a-sphere position="-3 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
                <a-sphere position="0 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
                <a-sphere position="3 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
            </a-cylinder>
            
            <!-- Bottom pipe -->
            <a-cylinder position="0 0.4 -0.9" 
                        radius="0.08" 
                        height="7.5" 
                        rotation="0 0 90"
                        color="#4a4a4a"
                        metalness="0.9"
                        roughness="0.2"
                        shadow="cast: true; receive: true">
                <a-sphere position="-3 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
                <a-sphere position="0 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
                <a-sphere position="3 0 0" radius="0.12" color="#3a3a3a" metalness="0.9"></a-sphere>
            </a-cylinder>

            <!-- Side support pipes -->
            <a-cylinder position="0.9 1.6 -1.5" 
                        radius="0.05" 
                        height="3.2" 
                        rotation="0 0 0"
                        color="#5a5a5a"
                        metalness="0.8"
                        roughness="0.3"></a-cylinder>
            
            <a-cylinder position="-0.9 1.6 1.5" 
                        radius="0.05" 
                        height="3.2" 
                        rotation="0 0 0"
                        color="#5a5a5a"
                        metalness="0.8"
                        roughness="0.3"></a-cylinder>
        </a-entity>

        <!-- TRAINING EQUIPMENT & HAZARDS -->
        
        <!-- Gas Meter (Task 1) - Fixed position -->
        <a-entity id="gas-meter" 
                  position="-0.6 1.2 2.5"
                  geometry="primitive: box; width: 0.15; height: 0.25; depth: 0.05"
                  material="color: #00ff00; metalness: 0.6; roughness: 0.4"
                  shadow="cast: true"
                  hoverable
                  grabbable
                  stretchable
                  draggable
                  gas-meter
                  class="interactive">
            <!-- Screen -->
            <a-box position="0 0.05 0.026" 
                   width="0.12" 
                   height="0.15" 
                   depth="0.001"
                   color="#001a00"></a-box>
            <!-- Display text -->
            <a-text value="O2: 20.9%\nLEL: 0%\nH2S: 0ppm" 
                    position="0 0.05 0.027"
                    align="center"
                    width="0.3"
                    color="#00ff00"></a-text>
            <!-- Indicator light -->
            <a-sphere position="0 0.15 0.026" 
                      radius="0.015" 
                      color="#00ff00"
                      material="emissive: #00ff00; emissiveIntensity: 0.8"></a-sphere>
        </a-entity>

        <!-- Leaking Hose (Task 2) - Fixed position -->
        <a-entity id="hazard-zone" position="0.7 0.8 -1.5">
            <!-- Hose connection -->
            <a-cylinder position="0 0 0" 
                        radius="0.04" 
                        height="0.7"
                        rotation="45 15 30"
                        color="#cc0000"
                        metalness="0.5"
                        roughness="0.7"
                        shadow="cast: true"></a-cylinder>
            
            <!-- Leak visual effect -->
            <a-entity id="leak-particles" position="0.3 0.3 0">
                <a-sphere radius="0.08" color="#ffffff" opacity="0.4" position="0 0 0"
                          animation="property: scale; to: 1.5 1.5 1.5; dur: 1000; loop: true; easing: easeOutQuad"></a-sphere>
                <a-sphere radius="0.06" color="#e0e0e0" opacity="0.3" position="0.1 0.1 0.1"
                          animation="property: scale; to: 1.8 1.8 1.8; dur: 1200; loop: true; easing: easeOutQuad; delay: 200"></a-sphere>
                <a-sphere radius="0.07" color="#f0f0f0" opacity="0.3" position="-0.1 0.05 -0.05"
                          animation="property: scale; to: 1.6 1.6 1.6; dur: 1100; loop: true; easing: easeOutQuad; delay: 400"></a-sphere>
            </a-entity>
            
            <!-- Warning sign -->
            <a-plane position="0 0.6 0" 
                     width="0.3" 
                     height="0.3" 
                     color="#ffff00"
                     rotation="0 -20 0">
                <a-text value="⚠" 
                        position="0 0 0.01"
                        align="center"
                        width="0.8"
                        color="#000000"></a-text>
            </a-plane>
            
            <!-- Proximity detector -->
            <a-box position="0 0 0"
                   width="1.2"
                   height="1.2"
                   depth="1.2"
                   visible="false"
                   hazard-detector></a-box>
        </a-entity>

        <!-- Isolation Valve (Tasks 3 & 4) - Fixed position -->
        <a-entity id="isolation-valve" position="-0.5 1.4 -2.5">
            <!-- Valve body -->
            <a-cylinder radius="0.12" 
                        height="0.4"
                        color="#555555"
                        metalness="0.8"
                        roughness="0.4"
                        shadow="cast: true"></a-cylinder>
            
            <!-- Pipe connection -->
            <a-cylinder position="0 0 0" 
                        radius="0.06" 
                        height="0.6"
                        rotation="0 0 90"
                        color="#666666"
                        metalness="0.7"
                        roughness="0.5"></a-cylinder>
            
            <!-- Valve wheel (interactive part) -->
            <a-entity id="valve-wheel"
                      position="0 0 0.25"
                      geometry="primitive: torus; radius: 0.18; radiusTubular: 0.025; segmentsTubular: 16"
                      material="color: #ff6600; metalness: 0.7; roughness: 0.4"
                      shadow="cast: true"
                      hoverable
                      grabbable
                      valve-controller
                      class="interactive">
                <!-- Wheel spokes -->
                <a-box position="0 0 0" 
                       width="0.36" 
                       height="0.025" 
                       depth="0.025" 
                       color="#ff6600"
                       metalness="0.7"></a-box>
                <a-box position="0 0 0" 
                       width="0.025" 
                       height="0.025" 
                       depth="0.36" 
                       color="#ff6600" 
                       rotation="0 90 0"
                       metalness="0.7"></a-box>
            </a-entity>
            
            <!-- Valve label plate -->
            <a-plane position="0 0.45 0" 
                     width="0.5" 
                     height="0.15"
                     color="#ffff00"
                     shadow="cast: true">
                <a-text value="ISOLATION VALVE" 
                        position="0 0 0.01"
                        align="center"
                        width="1.2"
                        color="#000000"></a-text>
            </a-plane>
        </a-entity>

        <!-- Warning Signs -->
        <a-entity position="-0.8 1.8 1.5" rotation="0 -20 0">
            <a-plane width="0.5" 
                     height="0.5" 
                     color="#ffff00"
                     shadow="cast: true">
                <a-triangle position="0 0 0.01"
                           vertex-a="0 0.2 0"
                           vertex-b="-0.17 -0.1 0"
                           vertex-c="0.17 -0.1 0"
                           color="#000000"></a-triangle>
                <a-text value="!\nCONFINED\nSPACE" 
                        position="0 -0.05 0.02"
                        align="center"
                        width="1.0"
                        color="#000000"></a-text>
            </a-plane>
        </a-entity>

        <!-- Emergency exit marker -->
        <a-plane position="0 2 3.8" 
                 width="0.8" 
                 height="0.3"
                 color="#00ff00"
                 rotation="0 180 0"
                 shadow="cast: true">
            <a-text value="◄ EMERGENCY EXIT" 
                    position="0 0 0.01"
                    align="center"
                    width="1.8"
                    color="#000000"
                    font="roboto"></a-text>
        </a-plane>

        <!-- Light fixtures (visual only) -->
        <a-entity position="0 3.1 1">
            <a-box width="0.6" height="0.1" depth="0.3" color="#e0e0e0" metalness="0.8"></a-box>
            <a-light type="point" intensity="0.5" distance="3" color="#ffffee"></a-light>
        </a-entity>
        
        <a-entity position="0 3.1 -2">
            <a-box width="0.6" height="0.1" depth="0.3" color="#e0e0e0" metalness="0.8"></a-box>
            <a-light type="point" intensity="0.5" distance="3" color="#ffffee"></a-light>
        </a-entity>

        <!-- Sky background -->
        <a-sky color="#87ceeb" opacity="0.3"></a-sky>
    </a-scene>
    
    <!-- Load custom components AFTER A-Frame -->
    <script src="js/main.js"></script>
</body>
</html>
