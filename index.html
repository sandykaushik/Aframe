<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Vault VR</title>

<!-- Core Libraries -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-super-hands-component@5.0.3/dist/aframe-super-hands.min.js"></script>

<style>
  body { margin: 0; background: black; }
</style>

<script>
/* ===============================
   GAME MANAGER
================================ */
AFRAME.registerComponent('game-manager', {
  init() {
    this.collected = 0;
    this.time = 60;
    this.ui = document.querySelector('#uiText');

    this.timer = setInterval(() => {
      this.time--;
      this.ui.setAttribute('value', `Energy: ${this.collected}/3  |  Time: ${this.time}`);

      if (this.time <= 0) {
        this.ui.setAttribute('value', 'GAME OVER');
        clearInterval(this.timer);
      }
    }, 1000);

    this.el.sceneEl.addEventListener('orb-collected', () => {
      this.collected++;
      if (this.collected === 3) {
        document.querySelector('#portal').setAttribute('visible', true);
      }
    });
  }
});

/* ===============================
   COLLECTIBLE ORB
================================ */
AFRAME.registerComponent('energy-orb', {
  init() {
    this.el.addEventListener('click', () => {
      this.el.emit('orb-collected');
      this.el.parentNode.removeChild(this.el);
    });
  }
});

/* ===============================
   PORTAL LOGIC
================================ */
AFRAME.registerComponent('portal', {
  init() {
    this.el.addEventListener('click', () => {
      document.querySelector('#uiText').setAttribute(
        'value',
        'YOU ESCAPED THE VAULT!'
      );
    });
  }
});

/* ===============================
   FACE CAMERA
================================ */
AFRAME.registerComponent('look-at-camera', {
  tick() {
    this.el.object3D.lookAt(
      this.el.sceneEl.camera.el.object3D.position
    );
  }
});
</script>
</head>

<body>

<a-scene
  background="color: #050015"
  fog="type: exponential; density: 0.04"
  renderer="physicallyCorrectLights: true">

  <!-- Lighting -->
  <a-light type="ambient" intensity="0.35"></a-light>
  <a-light type="point" intensity="2" color="#00ffff" position="0 3 -5"></a-light>

  <!-- Player Rig -->
  <a-entity id="rig"
    position="0 1.6 3"
    movement-controls="speed: 0.04">

    <a-camera
      wasd-controls-enabled="false"
      look-controls
      super-hands>
    </a-camera>
  </a-entity>

  <!-- Tunnel -->
  <a-cylinder
    radius="2"
    height="20"
    position="0 1 -7"
    rotation="90 0 0"
    material="
      color: #111;
      metalness: 0.7;
      roughness: 0.2;
      emissive: #00ffff;
      emissiveIntensity: 0.15;
      side: double">
  </a-cylinder>

  <!-- Energy Orbs -->
  <a-sphere position="-0.8 1.5 -3" radius="0.25"
    color="#00ffff" emissive="#00ffff"
    energy-orb></a-sphere>

  <a-sphere position="0.8 1.2 -6" radius="0.25"
    color="#ff00ff" emissive="#ff00ff"
    energy-orb></a-sphere>

  <a-sphere position="0 1.8 -9" radius="0.25"
    color="#00ff00" emissive="#00ff00"
    energy-orb></a-sphere>

  <!-- Exit Portal -->
  <a-ring id="portal"
    visible="false"
    position="0 1.6 -12"
    radius-inner="0.7"
    radius-outer="1.2"
    color="#00ffff"
    emissive="#00ffff"
    portal>
  </a-ring>

  <!-- UI -->
  <a-entity position="0 2.5 -1" look-at-camera>
    <a-text id="uiText"
      value="Energy: 0/3 | Time: 60"
      align="center"
      color="#00ffff"
      width="4">
    </a-text>
  </a-entity>

  <a-entity game-manager></a-entity>

</a-scene>

</body>
</html>
